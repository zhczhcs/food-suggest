<!-- pages/search/foodDt/foodDt.wxml -->
<base-header title="{{foodName || '食物详情'}}" showBack="{{true}}"></base-header>

<!-- 由于 base-header 是 fixed，页面内容需要留出顶部空间 -->
<scroll-view scroll-y class="container food-detail-container">
  <!-- 食物图片区域 -->
  <view class="food-image-wrapper">
    <image 
      wx:if="{{foodImg}}" 
      src="{{foodImg}}" 
      mode="aspectFill" 
      class="food-detail-image"
      binderror="onFoodImageError"
      data-cloudfileid="{{foodCloudFileId}}"
      data-foodname="{{foodName}}"
    ></image>
    <!-- 如果没有图片或加载失败，显示默认图片 -->
    <image 
      wx:else 
      src="/images/default_food.png" 
      mode="aspectFill" 
      class="food-detail-image"
    ></image>
  </view>

  <!-- 营养成分卡片 -->
  <view class="card">
    <text class="title">{{foodName}}</text>

    <!-- 主要营养成分 -->
    <view wx:if="{{nutritionData.main && mainNutritionKeys.length > 0}}">
      <text class="section-title">主要营养成分</text>
      <view class="form-item" wx:for="{{mainNutritionKeys}}" wx:for-item="key" wx:key="*this">
        <text class="label">{{key}}</text>
        <text class="value">{{nutritionData.main[key]}}</text>
      </view>
    </view>

    <!-- 维生素 -->
    <view wx:if="{{nutritionData.vitamins && vitaminKeys.length > 0}}">
      <text class="section-title">维生素</text>
      <view class="form-item" wx:for="{{vitaminKeys}}" wx:for-item="key" wx:key="*this">
        <text class="label">{{key}}</text>
        <text class="value">{{nutritionData.vitamins[key]}}</text>
      </view>
    </view>

    <!-- 矿物质 -->
    <view wx:if="{{nutritionData.minerals && mineralKeys.length > 0}}">
      <text class="section-title">矿物质</text>
      <view class="form-item" wx:for="{{mineralKeys}}" wx:for-item="key" wx:key="*this">
        <text class="label">{{key}}</text>
        <text class="value">{{nutritionData.minerals[key]}}</text>
      </view>
    </view>

    <!-- 加载状态和空数据提示 -->
    <view wx:if="{{loading}}" class="loading-tip">
      <text>正在加载详细营养信息...</text>
    </view>
    <view wx:if="{{!loading && loadError}}" class="empty-tip">
      <text>加载食物详情失败，请稍后再试。</text>
    </view>
    <view wx:if="{{!loading && !loadError && (!nutritionData.main && !nutritionData.vitamins && !nutritionData.minerals)}}" class="empty-tip">
      <text>未找到该食物的详细营养信息。</text>
    </view>
  </view>
</scroll-view>
